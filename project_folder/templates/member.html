<!-- member.html -->
<!DOCTYPE html>
<html lang="zh-TW">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>會員資料</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
        <style>
            .welcome-message {
                color: #e67e22;
                font-size: 18px;
                font-weight: 600;
                margin-bottom: 20px;
                margin-left: 15px;
                /* 這個值可以根據需要調整，確保不會碰到邊框 */
                text-align: left;
                /* 將文本向左對齊 */
            }
            .info-group {
                display: flex;
                justify-content: space-between;
                margin-bottom: 10px;
            }

            label {
                flex: 1;
                font-weight: bold;
            }

            p, input {
                flex: 2;
                margin: 0;
                padding: 5px;
                text-align: right;
            }

            input {
                border: 1px solid #ccc;
                border-radius: 4px;
                padding: 8px 12px; /* 增加內部間距 */
                width: 95%;       /* 調整輸入框的寬度，使其略大於默認 */
                box-sizing: border-box; /* 確保 padding 不會影響寬度計算 */
            }

            button {
                margin-top: 10px;
            }
        </style>
    </head>
    <body>
        <header>
            <nav>
                <a href="{{ url_for('index') }}" class="logo">大義麵親</a>
                <div class="menu-icon">
                    <div class="bar1"></div>
                    <div class="bar2"></div>
                    <div class="bar3"></div>
                </div>
                <div class="dropdown-menu">
                    {% if 'Customer_name' in session %}
                    <span class="welcome-message">歡迎, {{ session['Customer_name'] }}!</span>
                    {% endif %}

                    <a href="{{ url_for('menu') }}">菜單</a>
                    <a href="{{ url_for('reservation') }}">訂位</a>

                    {% if 'Customer_name' in session %}
                    <!-- 已登入顯示的內容 -->
                    <a href="{{ url_for('member') }}">會員頁面</a>
                    <a href="{{ url_for('logout') }}">登出</a>
                    {% else %}
                    <!-- 未登入顯示的內容 -->
                    <a href="{{ url_for('login') }}">登入/註冊</a>
                    {% endif %}
                </div>
            </nav>
        </header>

        <main class="member-main">
            <section class="member-info">
                <h2>會員資料</h2>
                <div class="info-group">
                    <label>姓名</label>
                    <p class="display-only" id="name-display">{{ customer.name }}</p>
                    <input type="text" class="edit-only" id="name-input" value="{{ customer.name }}" style="display: none;">
                </div>
                <div class="info-group">
                    <label>手機號碼</label>
                    <p class="display-only" id="phone-display">{{ customer.phone }}</p>
                    <input type="text" class="edit-only" id="phone-input" value="{{ customer.phone }}" style="display: none;">
                </div>
                <div class="info-group">
                    <label>密碼</label>
                    <p class="display-only" id="password-display">********</p>
                    <input type="password" class="edit-only" id="password-input" placeholder="輸入新密碼" style="display: none;">
                </div>
                <div class="info-group">
                    <label>點數</label>
                    <p id="points-display">{{ customer.point }}</p>
                </div>
                <button class="btn display-only" onclick="enableEdit()">修改資料</button>
                <div class="edit-only" style="display: none;">
                    <button class="btn" onclick="submitEdit()">提交</button>
                    <button class="btn" onclick="cancelEdit()">取消</button>
                </div>
            </section>

            <section class="order-history">
                <h2>訂單查詢</h2>
                <div class="orders">
                    {% if orders %}
                    <ul>
                        {% for order in orders %}
                        <li>
                            <div class="order-summary" onclick="toggleOrderDetails(this)">
                                <strong>訂單編號:</strong> {{ order['id'] }} |
                                <strong>訂單日期:</strong> {{ order['date'] }} |
                                <strong>總金額:</strong> NT$ {{ order['total']|int }}
                                <span class="toggle-icon">[展開]</span>
                                </div>
                            <div class="order-details" style="display: none;">
                                <strong>訂單明細:</strong>
                                <ul>
                                    {% for item in order['items'] %}
                                    <li>{{ item['name'] }} x {{ item['quantity'] }} - NT$ {{ item['price'] }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p>尚無訂單記錄。</p>
                    {% endif %}
                   </div>
            </section>


            

        </main>
        <script>
            function enableEdit() {
                // 切換到編輯模式
                document.querySelectorAll('.display-only').forEach(element => element.style.display = 'none');
                document.querySelectorAll('.edit-only').forEach(element => element.style.display = 'block');
            }

            function cancelEdit() {
                // 取消編輯，恢復顯示模式
                document.querySelectorAll('.display-only').forEach(element => element.style.display = 'block');
                document.querySelectorAll('.edit-only').forEach(element => element.style.display = 'none');
            }

            function submitEdit() {
                // 取得輸入值
                const name = document.getElementById('name-input').value;
                const phone = document.getElementById('phone-input').value;
                const password = document.getElementById('password-input').value;

                // 資料驗證（可選）
                if (!name || !phone) {
                    alert('姓名與手機號碼不可為空！');
                    return;
                }

                // 發送請求到後端
                const data = { name, phone, password };
                fetch('/update_customer_info', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                }).then(response => response.json())
                .then(result => {
                    if (result.success) {
                        // 更新顯示資料
                        document.getElementById('name-display').innerText = name;
                        document.getElementById('phone-display').innerText = phone;
                        alert('資料更新成功！');
                        cancelEdit();
                    } else {
                        alert(result.message);
                    }
                }).catch(error => {
                    console.error('Error:', error);
                    alert('更新失敗，請稍後重試。');
                });
            }

        </script>
        <script src="{{ url_for('static', filename='js/menu.js') }}"></script>
    function toggleOrderDetails(element) {
        const details = element.nextElementSibling; // 找到詳細資訊區塊
        const toggleIcon = element.querySelector('.toggle-icon'); // 找到展開/收起圖示

        if (details.style.display === "none" || details.style.display === "") {
            details.style.display = "block"; // 顯示詳細資訊
            toggleIcon.textContent = "[收起]"; // 更新圖示文字
        } else {
            details.style.display = "none"; // 隱藏詳細資訊
            toggleIcon.textContent = "[展開]"; // 更新圖示文字
        }
    }
    </body>
</html>
