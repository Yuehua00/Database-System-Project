<!-- member.html -->
<!DOCTYPE html>
<html lang="zh-TW">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>會員資料</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
        <style>
            .welcome-message {
                color: #4CAF50;
                font-size: 18px;
                font-weight: 600;
                margin-bottom: 20px;
                padding-bottom: 12px;
                border-bottom: 1px solid #eee;
            }
        </style>
    </head>
    <body>
        <header>
            <nav>
                <a href="{{ url_for('index') }}" class="logo">大義麵親</a>
                <div class="menu-icon">
                    <div class="bar1"></div>
                    <div class="bar2"></div>
                    <div class="bar3"></div>
                </div>
                <div class="dropdown-menu">
                    {% if 'Customer_name' in session %}
                    <span class="welcome-message">歡迎, {{ session['Customer_name'] }}!</span>
                    {% endif %}

                    <a href="{{ url_for('menu') }}">菜單</a>
                    <a href="{{ url_for('reservation') }}">訂位</a>
                    <a href="{{ url_for('cart') }}">查看購物車</a>

                    {% if 'Customer_name' in session %}
                    <!-- 已登入顯示的內容 -->
                    <a href="{{ url_for('member') }}">會員頁面</a>
                    <a href="{{ url_for('logout') }}">登出</a>
                    {% else %}
                    <!-- 未登入顯示的內容 -->
                    <a href="{{ url_for('login') }}">登入/註冊</a>
                    {% endif %}
                </div>
            </nav>
        </header>

        <main class="member-main">
            <section class="member-info">
                <h2>會員資料</h2>
                <div class="info-group">
                    <label>姓名</label>
                    <p id="member-name">{{ customer.name }}</p>
                </div>
                <div class="info-group">
                    <label>手機號碼</label>
                    <p id="member-phone">{{ customer.phone }}</p>
                </div>
                <!-- <div class="info-group">
                    <label>電子郵件</label>
                    <p id="member-email"></p>
                </div> -->
                <div class="info-group">
                    <label>密碼</label>
                    <button class="btn change-password" onclick="showPasswordChangeForm()">修改密碼</button>
                </div>
                <!-- 修改密碼表單，隱藏狀態 -->
                <div id="password-change-form" style="display: none;">
                    <label for="new-password">新密碼:</label>
                    <input type="password" id="new-password" name="new-password" required>

                    <label for="confirm-password">確認密碼:</label>
                    <input type="password" id="confirm-password" name="confirm-password" required>

                    <button class="btn" onclick="submitPasswordChange()">提交修改</button>
                    <button class="btn" onclick="hidePasswordChangeForm()">取消</button>
                </div>
                <div class="info-group">
                    <label>點數</label>
                    <p id="member-points">{{ customer.point }}</p>
                </div>
            </section>

            <section class="order-history">
                <h2>訂單查詢</h2>
                <div class="orders">
                    {% if orders %}
                    <ul>
                        {% for order in orders %}
                        <li>
                            訂單編號: {{ order['id'] }}<br>
                            訂單日期: {{ order['date'] }}<br>
                            總金額: NT$ {{ order['total'] }}
                        </li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    <p>尚無訂單記錄。</p>
                    {% endif %}
                </div>
            </section>

        </main>
        <script>
            // 顯示修改密碼表單
            function showPasswordChangeForm() {
                document.getElementById('password-change-form').style.display = 'block';
            }

            // 隱藏修改密碼表單
            function hidePasswordChangeForm() {
                document.getElementById('password-change-form').style.display = 'none';
            }

            // 提交修改密碼表單
            function submitPasswordChange() {
                var newPassword = document.getElementById('new-password').value;
                var confirmPassword = document.getElementById('confirm-password').value;

                if (newPassword === confirmPassword) {
                    // 發送修改密碼的請求到後端
                    fetch('/change-password', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            new_password: newPassword
                        })
                    }).then(response => response.json())
                        .then(data => {
                            alert(data.message);
                            if (data.success) {
                                hidePasswordChangeForm();
                            }
                        });
                } else {
                    alert("密碼不匹配，請重新輸入。");
                }
            }
        </script>
        <script src="{{ url_for('static', filename='js/menu.js') }}"></script>
    </body>
</html>