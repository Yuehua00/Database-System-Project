import React, { useState, useEffect } from 'react';
import { Trash2, MinusCircle, PlusCircle } from 'lucide-react';
import { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';
import { Button } from '@/components/ui/button';
import { Input } from '@/components/ui/input';
import { Checkbox } from '@/components/ui/checkbox';

const RestaurantCart = () => {
  // 初始菜單項目
  const [cartItems, setCartItems] = useState([
    { id: 1, name: '香煎雞胸', price: 180, quantity: 1 },
    { id: 2, name: '義大利麵', price: 220, quantity: 2 },
    { id: 3, name: '凱薩沙拉', price: 150, quantity: 1 }
  ]);

  // 點數設定
  const [usePoints, setUsePoints] = useState(false);
  const [availablePoints, setAvailablePoints] = useState(500);
  const pointDiscount = 50; // 每100點可折50元

  // 優惠代碼設定
  const [promoCode, setPromoCode] = useState('');
  const [promoDiscount, setPromoDiscount] = useState(0);
  const validPromoCodes = {
    'FIRST20': 0.2,
    'SUMMER10': 0.1
  };

  // 計算總金額
  const calculateTotal = () => {
    const subtotal = cartItems.reduce((total, item) => total + (item.price * item.quantity), 0);
    const pointsDiscount = usePoints ? Math.floor(availablePoints / 100) * pointDiscount : 0;
    const promoReduction = subtotal * (validPromoCodes[promoCode] || 0);
    return Math.max(subtotal - pointsDiscount - promoReduction, 0);
  };

  // 修改餐點數量
  const updateQuantity = (id, newQuantity) => {
    if (newQuantity < 1) {
      // 如果數量為0，移除餐點
      setCartItems(cartItems.filter(item => item.id !== id));
    } else {
      setCartItems(cartItems.map(item => 
        item.id === id ? { ...item, quantity: newQuantity } : item
      ));
    }
  };

  // 移除餐點
  const removeItem = (id) => {
    setCartItems(cartItems.filter(item => item.id !== id));
  };

  // 應用優惠代碼
  const applyPromoCode = () => {
    if (validPromoCodes[promoCode]) {
      setPromoDiscount(validPromoCodes[promoCode]);
      alert('優惠代碼已成功套用！');
    } else {
      alert('無效的優惠代碼');
      setPromoCode('');
    }
  };

  return (
    <div className="max-w-2xl mx-auto p-4">
      <Card>
        <CardHeader>
          <CardTitle>購物車</CardTitle>
        </CardHeader>
        <CardContent>
          {/* 餐點列表 */}
          {cartItems.map(item => (
            <div key={item.id} className="flex items-center justify-between border-b py-2">
              <div className="flex items-center space-x-4">
                <span>{item.name}</span>
                <span className="text-gray-500">NT${item.price}</span>
              </div>
              <div className="flex items-center space-x-2">
                <Button 
                  variant="outline" 
                  size="icon" 
                  onClick={() => updateQuantity(item.id, item.quantity - 1)}
                >
                  <MinusCircle className="h-4 w-4" />
                </Button>
                <span>{item.quantity}</span>
                <Button 
                  variant="outline" 
                  size="icon" 
                  onClick={() => updateQuantity(item.id, item.quantity + 1)}
                >
                  <PlusCircle className="h-4 w-4" />
                </Button>
                <Button 
                  variant="destructive" 
                  size="icon" 
                  onClick={() => removeItem(item.id)}
                >
                  <Trash2 className="h-4 w-4" />
                </Button>
              </div>
            </div>
          ))}

          {/* 點數折扣 */}
          <div className="flex items-center space-x-2 mt-4">
            <Checkbox 
              id="use-points" 
              checked={usePoints}
              onCheckedChange={setUsePoints}
            />
            <label htmlFor="use-points">
              使用點數折扣 (可用點數: {availablePoints})
            </label>
          </div>

          {/* 優惠代碼 */}
          <div className="flex items-center space-x-2 mt-4">
            <Input 
              placeholder="輸入優惠代碼" 
              value={promoCode}
              onChange={(e) => setPromoCode(e.target.value)}
            />
            <Button onClick={applyPromoCode}>套用</Button>
          </div>

          {/* 總金額 */}
          <div className="mt-4 text-right">
            <div className="text-xl font-bold">
              總金額：NT${calculateTotal()}
            </div>
          </div>

          {/* 結帳按鈕 */}
          <Button className="w-full mt-4">
            前往結帳
          </Button>
        </CardContent>
      </Card>
    </div>
  );
};

export default RestaurantCart;